<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epidemic</title>
    <style>
      body {
        background: black;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
      }

      canvas {
        border: 1px solid white;
      }
    </style>
  </head>
  <body>
    <canvas id="screen" width="640" height="640"></canvas>
    <script>
      // Get a reference to the canvas element
      const canvas = document.getElementById("screen")
      const ctx = canvas.getContext("2d")

      // Person
      class Person {
        constructor(x, y, state = 0) {
          this.x = x
          this.y = y
          this.radius = 8
          this.infectionRadius = 64
          this.infectionChance = 0.001
          this.direction = 0 // Angle in radians
          this.state = state // 0 is healthy, 1 is sick, 2 is recovered
        }

        infectNearby(persons) {
          // Only infected persons can infect others
          if (this.state !== 1) return;

          for (let person of persons) {
              // Check if the person is already infected or recovered
              if (person.state !== 0) continue;

              let dx = this.x - person.x;
              let dy = this.y - person.y;
              let distance = Math.sqrt(dx * dx + dy * dy);

              // Check if the person is within the infection radius
              if (distance <= this.infectionRadius) {
                  // Infect the person
                  if (Math.random() < this.infectionChance) {
                      person.state = 1; // Set the person's state to infected
                  }
              }
          }
        }

        draw(ctx) {
          if (this.state == 0) {
            ctx.fillStyle = "white"
          } else if (this.state == 1) {
            ctx.fillStyle = "red"          
          } else if (this.state == 2) {
            ctx.fillStyle = "gray"  
          }

          // Draw person
          ctx.beginPath()
          ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI)
          ctx.fill()

          // Draw infection radius
          if (this.state == 1) {
            ctx.fillStyle = "red"
            ctx.globalAlpha = 0.2
            
            ctx.beginPath()
            ctx.arc(this.x, this.y, this.infectionRadius, 0, 2 * Math.PI)
            ctx.fill()

            ctx.globalAlpha = 1.0;
          }
        }

        move(amount) {
          this.x += (Math.random() - 0.5) * 2 * amount
          this.y += (Math.random() - 0.5) * 2 * amount
          if (this.x > 640) this.x = 640;
          if (this.y > 640) this.y = 640;
          if (this.x < 0) this.x = 0;
          if (this.y < 0) this.y = 0;
        }
      }

      // Create 100 random persons
      let persons = []
      for (let i = 0; i < 100; i++) {
        let x = Math.random() * 640
        let y = Math.random() * 640
        let infected = Math.random() > 0.8
        persons.push(new Person(x, y, infected ? 1 : 0))
      }

      // Game loop
      function loop() {
        // Clear canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw persons
        for (let person of persons) {
          person.move(3)
          person.draw(ctx)
          person.infectNearby(persons)
        }

        // Loop every tick
        requestAnimationFrame(loop);
      }
      loop();

      // INFECTION
      // infection radius 
      // chance of infection when in radius
      // infection duration

      // SOCIAL DISTANCING
      // social distancing factor (how far apart)
      // % of population that obeys social distancing

      // QUARANTINE
      // quarantine after x days of infection
      // % of people don't sho    </script>
  </body>
</html>
